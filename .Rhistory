load02<- data.frame(round(cbind(inspect(fit2_c,what="std")$lambda,inspect(fit2_o,what="std")$lambda),digits = 2))
load02[load02==c(0.00)] <- NA; names(load02) <- c(1:4,1:4)
table02<- bind_cols(x = matpolyw02,y = load02)
# %>% mutate(vars=labs)
kable(table02,escape = FALSE,align = "l",col.names = cnametab)  %>%
footnote(general = paste0(paste0("$N$= ",nobs(fit2_c)),"; p<0.05=$*$; p<0.01=$**$; p<0.001=$***$"),footnote_as_chunk = T) %>%
add_header_above(c(" " = 1,"Polychoric correlations"=8, "MLR" = 4, "DWLS" = 4))%>%
add_header_above(c(" " = 9,"Factor loadings"=8)) %>%
column_spec(column = c(1),width ="7in",include_thead = T) %>%
column_spec(column = c(2:17),width ="0.5in",include_thead = T) %>%
kable_styling(full_width = FALSE) %>%
kable_styling(full_width = F)
# Chunk 16
stargazer(dat03,type = "html",
title = "Descriptive statistics",
font.size = "small",
median = TRUE,
header=FALSE,
digit.separator = "",
digits = 2,
covariate.labels = c("A. pc.effort", "B. pc.talent","C. pc.wpart","D. pc.netw","E. pf.effort","F. pf.talent","G. pf.wpart", "H. pf.netw"))
# Chunk 17
cor03<-polychoric(dat03)
rownames(cor03$rho) <-c("A. pc.effort", "B. pc.talent","C. pc.wpart","D. pc.netw","E. pf.effort","F. pf.talent","G. pf.wpart", "H. pf.netw")
colnames(cor03$rho) <-c("(A)","(B)","(C)","(D)","(E)","(F)","(G)", "(H)")
corrplot(cor03$rho,method = "color", type = "upper", tl.col = "black", addCoef.col = "black",diag = FALSE)
# Chunk 18
model03 <- '
perc_merit=~perc_effort+perc_talent
perc_nmerit=~perc_wpart+perc_netw
pref_merit=~pref_effort+pref_talent
pref_nmerit=~pref_wpart+pref_netw'
fit3_c <- cfa(model = model03,data = dat03,estimator="MLR",std.lv=FALSE) # Continuous/ estimator ML Robust
fit3_o <- cfa(model = model03,data = dat03,ordered = c("perc_effort","perc_talent",
"perc_wpart","perc_netw",
"pref_effort","pref_talent",
"pref_wpart","pref_netw"),std.lv=FALSE)
#---------------------------------------------------#
cnames <- c("Factor","Indicator","Loading (MLR)","Loading (DWLS)")
kable(left_join(x = standardizedsolution(fit3_c) %>% filter(op=="=~") %>% select(lhs,rhs,est.std),y = standardizedsolution(fit3_o) %>% filter(op=="=~") %>% select(lhs,rhs,est.std),c("lhs","rhs")),
format = "markdown",digits = 2,col.names = cnames, caption = "Factor loadings")
# Chunk 19
polyw03<- poly(sjlabelled::remove_all_labels(dat03),
digits = 2,
triangle = "l",
fade.ns = F,
remove.spaces = T,
string.diag = c("$-$","$-$","$-$","$-$","$-$","$-$","$-$","$-$"))
matpolyw03 <- as.data.frame(read_html(x = polyw03[["page.content"]]) %>% html_table(fill=FALSE))
matpolyw03 <- matpolyw03[-c(9),]
colnames(matpolyw03) <- c("vars","(A)","(B)","(C)","(D)","(E)","(F)","(G)", "(H)")
load03<- data.frame(round(cbind(inspect(fit3_c,what="std")$lambda,inspect(fit3_o,what="std")$lambda),digits = 2))
load03[load03==c(0.00)] <- NA; names(load03) <- c(1:4,1:4)
table03<- bind_cols(x = matpolyw03,y = load03)
# %>% mutate(vars=labs)
kable(table03,escape = FALSE,align = "l",col.names = cnametab) %>%
footnote(general = paste0(paste0("$N$= ",nobs(fit3_c)),"; p<0.05=$*$; p<0.01=$**$; p<0.001=$***$"),footnote_as_chunk = T) %>%
add_header_above(c(" " = 1,"Polychoric correlations"=8, "MLR" = 4, "DWLS" = 4))%>%
add_header_above(c(" " = 9,"Factor loadings"=8)) %>%
column_spec(column = c(1),width ="7in",include_thead = T) %>%
column_spec(column = c(2:17),width ="0.5in",include_thead = T) %>%
kable_styling(full_width = F)
# Chunk 20
model03.tau <- '
perc_merit=~ r1*perc_effort+r1*perc_talent
perc_nmerit=~r2*perc_wpart+ r2*perc_netw
pref_merit=~ r3*pref_effort+r3*pref_talent
pref_nmerit=~r4*pref_wpart+ r4*pref_netw'
fit3_c.tau <- cfa(model = model03.tau,data = dat03,estimator="MLR",std.lv=FALSE) # Continuous/ estimator ML Robust
fit3_o.tau <- cfa(model = model03.tau,data = dat03,ordered = c("perc_effort","perc_talent",
"perc_wpart","perc_netw",
"pref_effort","pref_talent",
"pref_wpart","pref_netw"), std.lv=FALSE)
#---------------------------------------------------#
cnames <- c("Factor","Indicator","Loading (MLR)","Loading (DWLS)")
kable(left_join(x = standardizedsolution(fit3_c.tau ) %>% filter(op=="=~") %>% select(lhs,rhs,est.std),y = standardizedsolution(fit3_o.tau) %>% filter(op=="=~") %>% select(lhs,rhs,est.std),c("lhs","rhs")),
format = "markdown",digits = 2,col.names = cnames)
# Chunk 21
kable(rbind(Ordinal    =fitmeasures(fit3_o    )[c("chisq.scaled","df","cfi","cfi.scaled","cfi.robust","rmsea","rmsea.scaled","rmsea.robust")],
Ordinal.tau=fitmeasures(fit3_o.tau)[c("chisq.scaled","df","cfi","cfi.scaled","cfi.robust","rmsea","rmsea.scaled","rmsea.robust")]),
format = "markdown",
digits = 3, caption = "Fit tau-equivalence")
kable(anova(fit3_o,fit3_o.tau),
format = "markdown",
digits = 3)
# Chunk 22: tabla03
polyw03tau<- poly(sjlabelled::remove_all_labels(dat03),
digits = 2,
triangle = "l",
fade.ns = F,
remove.spaces = T,
string.diag = c("$-$","$-$","$-$","$-$","$-$","$-$","$-$","$-$"))
matpolyw03tau <- as.data.frame(read_html(x = polyw03tau[["page.content"]]) %>% html_table(fill=FALSE))
matpolyw03tau <- matpolyw03tau[-c(9),]
colnames(matpolyw03tau) <- c("vars","(A)","(B)","(C)","(D)","(E)","(F)","(G)", "(H)")
load03tau<- data.frame(round(cbind(inspect(fit3_c.tau,what="std")$lambda,inspect(fit3_o.tau,what="std")$lambda),digits = 2))
load03tau[load03tau==c(0.00)] <- NA; names(load03tau) <- c(1:4,1:4)
table03tau<- bind_cols(x = matpolyw03tau,y = load03tau)
# %>% mutate(vars=labs)
kable(table03tau,escape = FALSE,align = "l",col.names = cnametab) %>%
footnote(general = paste0(paste0("$N$= ",nobs(fit3_c.tau)),"; p<0.05=$*$; p<0.01=$**$; p<0.001=$***$"),footnote_as_chunk = T) %>%
add_header_above(c(" " = 1,"Polychoric correlations"=8, "MLR" = 4, "DWLS" = 4))%>%
add_header_above(c(" " = 9,"Factor loadings"=8)) %>%
column_spec(column = c(1),width ="7in",include_thead = T) %>%
column_spec(column = c(2:17),width ="0.5in",include_thead = T) %>%
kable_styling(full_width = F)
# Chunk 23
stargazer(select(dat04,perc_effort,perc_talent,perc_wpart,perc_netw,pref_effort,pref_talent,pref_wpart,pref_netw),
type = "html",
title = "Descriptive statistics",
font.size = "small",
median = TRUE,
header=FALSE,
digit.separator = "",
digits = 2,
covariate.labels = c("A. pc.effort", "B. pc.talent","C. pc.wpart","D. pc.netw","E. pf.effort","F. pf.talent","G. pf.wpart", "H. pf.netw"))
# Chunk 24
cor04<-polychoric(select(dat04,perc_effort,perc_talent,perc_wpart,perc_netw,pref_effort,pref_talent,pref_wpart,pref_netw))
rownames(cor04$rho) <-c("A.Perception Effort", "B.Perception Talent","C.Perception Rich parents","D.Perception contacts","E.Preferences Effort","F.Preferences Talent","G.Preferences rich parents", "H.Preferences contacts" )
colnames(cor04$rho) <-c("(A)", "(B)","(C)","(D)","(E)","(F)","(G)", "(H)")
save(cor04, file = "output/images/correlation.RData")
corrplot(cor04$rho,method = "color", type = "upper", tl.col = "black", addCoef.col = "black",diag = FALSE)
png("output/images/corpoly.png",
width = 15,height = 15,units="cm",
pointsize=12,bg="white",res=300)
corrplot(cor01$rho,method = "color" ,type = "upper", tl.col = "black", addCoef.col = "black",diag = FALSE)
dev.off()
# Chunk 25
model04 <- '
perc_merit =~ perc_effort+perc_talent
perc_nmerit=~perc_wpart +perc_netw
pref_merit =~ pref_effort+pref_talent
pref_nmerit=~pref_wpart +pref_netw'
fit4_c <- cfa(model = model04,data = dat04,estimator="MLR",std.lv=FALSE) # Continuous/ estimator ML Robust
fit4_o <- cfa(model = model04,data = dat04,ordered = c("perc_effort","perc_talent",
"perc_wpart","perc_netw",
"pref_effort","pref_talent",
"pref_wpart","pref_netw"),std.lv=FALSE)
#---------------------------------------------------#
cnames <- c("Factor","Indicator","Loading (MLR)","Loading (DWLS)")
kable(left_join(x = standardizedsolution(fit4_c ) %>% filter(op=="=~") %>% select(lhs,rhs,est.std),y = standardizedsolution(fit4_o) %>% filter(op=="=~") %>% select(lhs,rhs,est.std),c("lhs","rhs")),
format = "markdown",digits = 2,col.names = cnames, caption = "Factor loadings")
# Chunk 26: tabla04
polyw04<- poly(sjlabelled::remove_all_labels(dat04[,-c(1)]),
digits = 2,
triangle = "l",
fade.ns = F,
remove.spaces = T,
string.diag = c("$-$","$-$","$-$","$-$","$-$","$-$","$-$","$-$"))
matpolyw04 <- as.data.frame(read_html(x = polyw04[["page.content"]]) %>% html_table(fill=FALSE))
matpolyw04 <- matpolyw04[-c(9),]
colnames(matpolyw04) <- c("vars","(A)","(B)","(C)","(D)","(E)","(F)","(G)", "(H)")
load04<- data.frame(round(cbind(inspect(fit4_c,what="std")$lambda,inspect(fit4_o,what="std")$lambda),digits = 2))
load04[load04==c(0.00)] <- NA; names(load04) <- c(1:4,1:4)
table04<- bind_cols(x = matpolyw04,y = load04)
# %>% mutate(vars=labs)
kable(table04,escape = FALSE,align = "l",col.names = cnametab) %>%
footnote(general = paste0(paste0("$N$= ",nobs(fit4_c)),"; p<0.05=$*$; p<0.01=$**$; p<0.001=$***$"),footnote_as_chunk = T) %>%
add_header_above(c(" " = 1,"Polychoric correlations"=8, "MLR" = 4, "DWLS" = 4))%>%
add_header_above(c(" " = 9,"Factor loadings"=8)) %>%
column_spec(column = c(1),width ="7in",include_thead = T) %>%
column_spec(column = c(2:17),width ="0.5in",include_thead = T) %>%
kable_styling(full_width = F)
# Chunk 27: tb_desc-corr
load04<- data.frame(round(inspect(fit4_o,what="std")$lambda,digits = 2))
load04[load04==c(0.00)] <- NA; names(load04) <- c(1:4)
colnames(matpolyw04) <- c("Variable","A","B","C","D","E","F","G", "H")
sum04b  <- psych::describe(dat04[,-c(1)], fast = T) %>% select(mean,sd,min,max) %>% data.frame() %>% round(digits = 2)
table04b<- bind_cols(x = sum04b,y = matpolyw04) %>% select(Variable, everything()) %>% mutate(Variable=labs) %>% rename("Mean"=mean, "SD"=sd, "Min"=min,"Max"=max)
cap01 <- "Descriptive statistic"
sumdat04<- kable(table04b, escape = FALSE,align = "l",linesep = "", caption = cap01) %>%
column_spec(column = 1,width = "10cm",width_min = "12cm",include_thead = TRUE) %>%
footnote(general = paste0(paste0("$N$= ","2141"),"; p<0.05=$*$; p<0.01=$**$; p<0.001=$***$"),footnote_as_chunk = T) %>%
add_header_above(header = c(" "=5,"Polychoric correlations"= 8)) %>%
kable_styling(full_width = TRUE,font_size = 8,position = "center");sumdat04
save(sumdat04,file = "output/tables/sumdat04.RData")
# Chunk 28: tb_loads-fitm
tb.load<- data.frame(round(cbind(inspect(fit1_o,what="std")$lambda,
inspect(fit2_o,what="std")$lambda,
inspect(fit3_o,what="std")$lambda),
digits = 2))
tb.load[tb.load==c(0.00)] <- NA; names(tb.load) <- c(paste0("M1.",1:4),paste0("M2.",1:4),paste0("M3.",1:4))
for (i in names(tb.load)) {
# tb.load[,i] <- sjlabelled::as_character(tb.load[,i])
tb.load[,i] <- sprintf(tb.load[,i], fmt = '%#.2f')
}
tb.load[tb.load=="NA"] <- ""
#-------#
fm01<- data.frame(t(data.frame(fitmeasures(fit1_o, output ="matrix")[c("chisq.scaled","df","cfi.scaled","rmsea.scaled"),]))); row.names(fm01) ="M1.1"
fm02<- data.frame(t(data.frame(fitmeasures(fit2_o, output ="matrix")[c("chisq.scaled","df","cfi.scaled","rmsea.scaled"),]))); row.names(fm02) ="M2.1"
fm03<- data.frame(t(data.frame(fitmeasures(fit3_o, output ="matrix")[c("chisq.scaled","df","cfi.scaled","rmsea.scaled"),]))); row.names(fm03) ="M3.1"
#------chi2, df------#
fm04<- round(rbind(fm01,fm02,fm03),3)
fm04.1 <- fm04 %>% select(chisq.scaled,df)
fm04.1$chisq.scaled <- round(x = fm04.1$chisq.scaled,digits = 1)
fm04.1$df <- round(x = fm04.1$df,digits = 0)
fm04.1$chi2df <- paste0(fm04.1$chisq.scaled,"(",fm04.1$df,")")
fm04.1 <- select(fm04.1,"chi2df")
for (i in names(fm04.1)) {
fm04.1[,i] <- as.character(fm04.1[,i])
}
#------CFI, RMSEA------#
fm04.2 <- fm04 %>% select(cfi.scaled,rmsea.scaled)
for (i in names(fm04.2)) {
fm04.2[,i] <- sprintf(fm04.2[,i], fmt = '%#.3f')
}
fm.df      <- bind_cols(fm04.1,fm04.2)
fm.df$nobs <- c(nobs(fit1_o),nobs(fit2_o),nobs(fit3_o))
fm.df <- data.frame(t(fm.df)); colnames(fm.df) <- c("M1.2","M2.2","M3.2")
#------ merge ------#
tb.fm<- bind_rows(tb.load,fm.df)
tb.fm<- tb.fm %>% mutate(vars=c(labs,"$\\chi^2\\text{(df)}$","$\\text{CFI}$","$\\text{RMSEA}$","$N$")) %>% select(vars,everything())
#--table---#
tb.col  <- c("Variables",1:4,1:4,1:4)
tb.foot <- paste0("; p<0.05=$*$; p<0.01=$**$; p<0.001=$***$. Standardised factor loadings using DWLS estimator. CFI = Comparative fit index (scaled), RMSEA = Root mean square error of approximation (scaled)")
tb.caption <- "Factor loadings and fit measures"
tb.fm01<- kable(tb.fm,escape = FALSE,align = "lcccccccccccc",col.names = tb.col, caption = tb.caption) %>%
kable_styling(full_width = F,font_size = 9) %>%
column_spec(column = 1,width = "10cm",width_min = "12cm",include_thead = TRUE) %>%
column_spec(column = 2:13,width = "1cm",width_min = "1.3cm",include_thead = TRUE) %>%
add_header_above(header = c(" "=1,"Version 1"= 4,"Version 2"= 4,"Version 3"= 4)) %>%
add_header_above(header = c(" "=1,"Factor loadings"= 12)) %>%
row_spec(row = 8,hline_after = TRUE) %>%
add_indent(c(9:12)) %>%
footnote(general =tb.foot ,footnote_as_chunk = T);tb.fm01
save(tb.fm01,file = "output/tables/tb.fm01.RData")
save(tb.fm,file = "output/tables/tb.fm.RData")
save(fm.df,file = "output/tables/fm.df.RData")
save(tb.load,file = "output/tables/tb.load.RData")
# Chunk 29: compare corr
corrplot(cor01$rho,method = "color" ,type = "upper", tl.col = "black", addCoef.col = "black",diag = FALSE)
corrplot(cor02$rho,method = "color", type = "upper", tl.col = "black", addCoef.col = "black",diag = FALSE)
corrplot(cor03$rho,method = "color", type = "upper", tl.col = "black", addCoef.col = "black",diag = FALSE)
# Chunk 30: semPlot
model01 <- 'perc_merit=~perc_effort+perc_talent
perc_nmerit=~perc_wpart+perc_netw
pref_merit=~pref_effort+pref_talent
pref_nmerit=~pref_wpart+pref_netw'
plot01 <- cfa(model = model01,data = dat01,estimator="MLR",std.lv=TRUE)
nodeNames <-c("Perception effort","Perception talent","Perception rich family","Perception contacts",
"Preference effort","Preference talent","Preference rich family","Preference contacts",
"Perception meritocratic","Perception non meritocratic","Preference meritocratic","Preference non meritocratic")
dir.create("output/images")
semPaths(plot01,
style = "lisrel",
fade=FALSE,
edge.color = "black",
nCharNodes = 0,
curvePivot = FALSE,
curve = 2,
rotation = 4,
layout = "tree3",
cardinal = "lat cov",
legend.cex = 0.6,
label.cex =1,
reorder = FALSE,
nodeNames = nodeNames,
nodeLabels = c("A","B","C","D","E","F","G","H","1","2","3","4"),
label.font = 6,
edge.label.font= 1,
asize = 3, #arrow size
edge.width =1,
sizeMan=5,
sizeLat = 10,
filetype ="png",
width = 12,
height= 10,
filename = "output/images/meas01")
# Chunk 31
sum_fit<- bind_rows(fitmeasures(fit1_c)[c("chisq.scaled","df","cfi","cfi.scaled","cfi.robust","rmsea","rmsea.scaled","rmsea.robust")],
fitmeasures(fit1_o)[c("chisq.scaled","df","cfi","cfi.scaled","cfi.robust","rmsea","rmsea.scaled","rmsea.robust")],
fitmeasures(fit2_c)[c("chisq.scaled","df","cfi","cfi.scaled","cfi.robust","rmsea","rmsea.scaled","rmsea.robust")],
fitmeasures(fit2_o)[c("chisq.scaled","df","cfi","cfi.scaled","cfi.robust","rmsea","rmsea.scaled","rmsea.robust")],
fitmeasures(fit3_c)[c("chisq.scaled","df","cfi","cfi.scaled","cfi.robust","rmsea","rmsea.scaled","rmsea.robust")],
fitmeasures(fit3_o)[c("chisq.scaled","df","cfi","cfi.scaled","cfi.robust","rmsea","rmsea.scaled","rmsea.robust")],
fitmeasures(fit4_c)[c("chisq.scaled","df","cfi","cfi.scaled","cfi.robust","rmsea","rmsea.scaled","rmsea.robust")],
fitmeasures(fit4_o)[c("chisq.scaled","df","cfi","cfi.scaled","cfi.robust","rmsea","rmsea.scaled","rmsea.robust")])
sum_fit$mod <- c("Model 1","Model 1","Model 2","Model 2","Model 3","Model 3","Model 4","Model 4")
sum_fit$est <- c("MLR","DWLS","MLR","DWLS","MLR","DWLS","MLR","DWLS")
sum_fit <- select(sum_fit,mod,est,everything())
colnames <- c("Model","Estimator","$\\chi^2$","df","CFI","CFI.sca","CFI.rob","RMSEA","RMSEA.sca","RMSEA.rob")
sumtable01<- kable(sum_fit,digits = 3,format = "html",row.names = F,booktabs=T, caption = "Summary fit indices wave 01",col.names = colnames,escape = FALSE) %>%
kable_styling(full_width = F)  %>%
collapse_rows(columns = 1,valign = "middle")  %>%
footnote(number = c("Model 1: fixed order by percepction/preference",
"Model 2: fixed order by topic (i.e: effort)",
"Model 3: Randomized order",
"Model 4: Complete sample"));sumtable01
# Save sumamry table wave 01------------------------------#
# as_image(sumtable01,file = "output/sumtablew01.png")
# save_kable(sumtable01,file = "output/tables/sumtablew01.html",self_contained = FALSE)
# Chunk 32
model04 <- '
perc_merit =~ perc_effort + perc_talent
perc_nmerit=~ perc_wpart  + perc_netw
pref_merit =~ pref_effort + pref_talent
pref_nmerit=~ pref_wpart  + pref_netw'
fit4_c_mg <- cfa(model = model04,data = dat04,estimator="MLR",std.lv=FALSE,group = "grupo") # Continuous/ estimator ML Robust
fit4_o_mg <- cfa(model = model04,data = dat04,ordered = c("perc_effort","perc_talent",
"perc_wpart","perc_netw",
"pref_effort","pref_talent",
"pref_wpart","pref_netw"),std.lv=FALSE, group = "grupo")
#---------------------------------------------------#
kable(rbind(Continuous=fitmeasures(fit4_c_mg)[c("chisq.scaled","df","cfi","cfi.scaled","cfi.robust","rmsea","rmsea.scaled","rmsea.robust")],
Ordinal=  fitmeasures(fit4_o_mg)[c("chisq.scaled","df","cfi","cfi.scaled","cfi.robust","rmsea","rmsea.scaled","rmsea.robust")]),
format = "markdown",digits = 3,caption = "Fit indices")
gr01=standardizedsolution(fit4_c_mg) %>% filter(op=="=~") %>% select(group,lhs,rhs,est.std)
gr02=standardizedsolution(fit4_o_mg) %>% filter(op=="=~") %>% select(group,lhs,rhs,est.std)
gr01$group=dplyr::recode(gr01$group, `1` = "mod03", `2` = "mod02", `3` = "mod01")
gr02$group=dplyr::recode(gr02$group, `1` = "mod03", `2` = "mod02", `3` = "mod01")
cnames <- c("Grupo","Factor","Indicator","Loading (MLR)","Loading (DWLS)")
kable(left_join(x =gr01 ,
y =gr02 ,
c("group","lhs","rhs")),
format = "markdown",digits = 2,col.names = cnames,caption = "Factor loadings by group")
# Chunk 33
model04b1or <- '
perc_merit=~ perc_effort+perc_talent
perc_nmerit=~perc_wpart +perc_netw
pref_merit=~ pref_effort+pref_talent
pref_nmerit=~pref_wpart +pref_netw
percep=~ perc_merit + perc_nmerit
prefer=~ pref_merit + pref_nmerit'
fit4a_c <- cfa(model = model04b1or,data = dat04, estimator="MLR")
fit4b_c <- cfa(model = model04b1or,data = dat04,ordered = c("perc_effort","perc_talent","perc_wpart","perc_netw",
"pref_effort","pref_talent","pref_wpart","pref_netw"))
#---------------------------------------------------#
kable(rbind(Continuous=fitmeasures(fit4a_c)[c("chisq.scaled","df","cfi","cfi.scaled","cfi.robust","rmsea","rmsea.scaled","rmsea.robust")],
Ordinal= fitmeasures(fit4b_c)[c("chisq.scaled","df","cfi","cfi.scaled","cfi.robust","rmsea","rmsea.scaled","rmsea.robust")]),
format = "markdown",digits = 3)
cnames <- c("Factor","Indicator","Loading (MLR)","Loading (DWLS)")
kable(left_join(x = standardizedsolution(fit4a_c) %>% filter(op=="=~") %>% select(lhs,rhs,est.std),
y = standardizedsolution(fit4b_c) %>% filter(op=="=~") %>% select(lhs,rhs,est.std),
c("lhs","rhs")),
format = "markdown",digits = 2,col.names = cnames,caption = "Factor loadings")
# Chunk 34
model04b2or <-'perc_merit=~ perc_effort+perc_talent
perc_nmerit=~perc_wpart +perc_netw
pref_merit=~ pref_effort+pref_talent
pref_nmerit=~pref_wpart +pref_netw
merit =~ perc_merit  + pref_merit
nmerit=~ perc_nmerit + pref_nmerit'
# fit4b_c <- cfa(model = model04b2or,data = dat04,estimator="MLR") # No converge
fit4b_o <- cfa(model = model04b2or,data = dat04,
ordered = c("perc_effort","perc_talent","perc_wpart","perc_netw",
"pref_effort","pref_talent","pref_wpart","pref_netw"))
#---------------------------------------------------#
kable(rbind(Ordinal=fitmeasures(fit4b_o)[c("chisq.scaled","df","cfi","cfi.scaled","cfi.robust","rmsea","rmsea.scaled","rmsea.robust")]),
format = "markdown",digits = 3)
cnames <- c("Factor","Indicator","Loading (DWLS)")
kable(standardizedsolution(fit4b_o) %>% filter(op=="=~") %>% select(lhs,rhs,est.std),
format = "markdown",digits = 2,col.names = cnames,caption = "Factor loadings")
# Chunk 35
library(ggplot2)
library(reshape2)
library(sjPlot)
library(dplyr)
#install.packages("cowplot")
library(cowplot)
dat_merit <- dat04 %>% select("a.Effort"=perc_effort,"a.Talent"=perc_talent, "a.Rich Parents"=perc_wpart, "a.Contacts"=perc_netw, "b.Effort"=pref_effort,"b.Talent"=pref_talent,"b.Rich Parents"=pref_wpart, "b.Contacts"=pref_netw)
plotlikert<-plot_likert(dat_merit, c(1,1,1,1,2,2,2,2),
groups.titles = c("Perceptions","Preferences"),
geom.colors ="PuBu",
geom.size = 0.8,
axis.labels=c("Effort","Talent","Rich Parents","Contacts"),
catcount = 4,
cat.neutral = 3,
grid.range  =  c ( 1.2 , 1.4 ),
values  =  "sum.outside",
reverse.scale=TRUE)
plotlikert
ggsave(plotlikert,filename = "output/images/plotlikert.png",device = "png",width = 18,height = 15,dpi = "retina",units = "cm")
# Chunk 36
load(file = "input/data/original/issp2019CL.RData")
w01 <- sjlabelled::read_spss("input/data/original/Estudio_3_ola1.sav",verbose = F)
# Chunk 37
GS<- c("CERRILLOS",
"CERRO NAVIA",
"CONCHALÍ",
"EL BOSQUE",
"ESTACIÓN CENTRAL",
"HUECHURABA",
"INDEPENDENCIA",
"LA CISTERNA",
"LA FLORIDA",
"LA GRANJA",
"LA PINTANA",
"LA REINA",
"LAS CONDES",
"LO BARNECHEA",
"LO ESPEJO",
"LO PRADO",
"MACUL",
"MAIPÚ",
"ÑUÑOA",
"PEDRO AGUIRRE CERDA",
"PEÑALOLEN",
"PROVIDENCIA",
"PUDAHUEL",
"PUENTE ALTO",
"QUILICURA",
"QUINTA NORMAL",
"RECOLETA",
"RENCA",
"SAN BERNARDO",
"SAN JOAQUÍN",
"SAN MIGUEL",
"SAN RAMÓN",
"SANTIAGO",
"VITACURA")
cl19$COMUNA <- toupper(as_character(cl19$COMUNA))
# cl19$DS_P1 # 1= hombre, 2= mujer
# cl19$DS_P2_EXACTA
# cl19$DS_P4
cep1 <- cl19 %>%
select(COMUNA,DS_P1,DS_P2_EXACTA,DS_P4, FACTOR) %>%
filter(COMUNA %in% GS)
# Chunk 38
cep1$edad_cat<- as.numeric(cep1$DS_P2_EXACTA) # Edad
cep1$edad_cat[cep1$edad_cat %in%c(18:24)] <- 1   #"18 a 24"
cep1$edad_cat[cep1$edad_cat %in%c(25:34)] <- 2 # "25 a 34"
cep1$edad_cat[cep1$edad_cat %in%c(35:44)] <- 3 # "35 a 44"
cep1$edad_cat[cep1$edad_cat %in%c(45:54)] <- 4 # "45 a 54"
cep1$edad_cat[cep1$edad_cat >=  55]       <- 5 # "55 o más"
cep1$educ <- cep1$DS_P4 # Educación
cep1$educ <- as_numeric(cep1$educ)
cep1$educ <- as.numeric(cep1$educ)
cep1$educ[cep1$educ %in%c(88,99)] <- NA
cep1$educ <- recode(cep1$educ, "0" = "1" , "1"="1", "2" = "1", "3"="2","4"="2", "5"="3","6"="3", "7" = "3", "8"="4" , "9"="4"   )
cep1$sexo <- as.numeric(cep1$DS_P1) # 1= hombre, 2= mujer
# Chunk 39
# Gender
cep1$Hombres<-ifelse(cep1$sexo==1,100,0)
cep1$Mujeres<-ifelse(cep1$sexo==2,100,0)
w01$Hombres<-ifelse(w01$sexo==1,100,0)
w01$Mujeres<-ifelse(w01$sexo==2,100,0)
cep1$ed_a<-ifelse(cep1$edad_cat==1,100,0)
cep1$ed_b<-ifelse(cep1$edad_cat==2,100,0)
cep1$ed_c<-ifelse(cep1$edad_cat==3,100,0)
cep1$ed_d<-ifelse(cep1$edad_cat==4,100,0)
cep1$ed_e<-ifelse(cep1$edad_cat==5,100,0)
w01$ed_a<-ifelse(w01$edad==1,100,0)
w01$ed_b<-ifelse(w01$edad==2,100,0)
w01$ed_c<-ifelse(w01$edad==3,100,0)
w01$ed_d<-ifelse(w01$edad==4,100,0)
w01$ed_e<-ifelse(w01$edad==5,100,0)
cep1$educ_a<-ifelse(cep1$educ==1,100,0)
cep1$educ_b<-ifelse(cep1$educ==2,100,0)
cep1$educ_c<-ifelse(cep1$educ==3,100,0)
cep1$educ_d<-ifelse(cep1$educ==4,100,0)
w01$educ_a<-ifelse(w01$educat==1,100,0)
w01$educ_b<-ifelse(w01$educat==2,100,0)
w01$educ_c<-ifelse(w01$educat==3,100,0)
w01$educ_d<-ifelse(w01$educat==4,100,0)
Men<-round(c(mean(w01$Hombres, na.rm = T), weighted.mean(cep1$Hombres,cep1$FACTOR, na.rm = T)),digits = 2)
Women<-round(c(mean(w01$Mujeres, na.rm = T), weighted.mean(cep1$Mujeres,cep1$FACTOR, na.rm = T)),digits = 2)
years.18.to.24<-round(c(mean(w01$ed_a, na.rm = T), weighted.mean(cep1$ed_a,cep1$FACTOR, na.rm = T)),digits = 2)
years.25.to.34<-round(c(mean(w01$ed_b, na.rm = T), weighted.mean(cep1$ed_b,cep1$FACTOR, na.rm = T)),digits = 2)
years.35.to.44<-round(c(mean(w01$ed_c, na.rm = T), weighted.mean(cep1$ed_c,cep1$FACTOR, na.rm = T)),digits = 2)
years.45.to.54<-round(c(mean(w01$ed_d, na.rm = T), weighted.mean(cep1$ed_d,cep1$FACTOR, na.rm = T)),digits = 2)
years.55.or.more<-round(c(mean(w01$ed_e, na.rm = T), weighted.mean(cep1$ed_e,cep1$FACTOR, na.rm = T)),digits = 2)
Primary <-round(c(mean(w01$educ_a, na.rm = T), weighted.mean(cep1$educ_a,cep1$FACTOR, na.rm = T)),digits = 2)
Secondary<-round(c(mean(w01$educ_b, na.rm = T), weighted.mean(cep1$educ_b,cep1$FACTOR, na.rm = T)),digits = 2)
Technique<-round(c(mean(w01$educ_c, na.rm = T), weighted.mean(cep1$educ_c,cep1$FACTOR, na.rm = T)),digits = 2)
University<-round(c(mean(w01$educ_d, na.rm = T), weighted.mean(cep1$educ_d,cep1$FACTOR, na.rm = T)),digits = 2)
sample_cep<- rbind("__Gender__",Men,Women,"__Age__",years.18.to.24,years.25.to.34,years.35.to.44,years.45.to.54,years.55.or.more, "__Education__", Primary, Secondary, Technique, University)
cnames <- c("Sample", "CEP")
knitr::kable(sample_cep, digits = 0, format = "markdown",col.names = cnames)
# Chunk 40
load(file = "input/data/proc/dat01.RData")
load(file = "input/data/proc/dat02.RData")
load(file = "input/data/proc/dat03.RData")
load(file = "input/data/proc/dat04.RData")
# Chunk 41
lav.mod.1 <- 'perc_merit =~ perc_effort+perc_talent
perc_nmerit=~perc_wpart +perc_netw
pref_merit =~ pref_effort+pref_talent
pref_nmerit=~pref_wpart +pref_netw'
cor01a<-polychoric(dat01)
cor02a<-polychoric(dat02)
cor03a<-polychoric(dat03)
cor04a <-polychoric(select(dat04,perc_effort,perc_talent,perc_wpart,perc_netw,pref_effort,pref_talent,pref_wpart,pref_netw))
#Omega for group
lav.jen.1<- cfa(lav.mod.1,sample.cov=cor01a$rho,sample.nobs=500,orthogonal=TRUE,std.lv=TRUE) # Total sample
lav.jen.2<- cfa(lav.mod.1,sample.cov=cor02a$rho,sample.nobs=500,orthogonal=TRUE,std.lv=TRUE) # Total sample
lav.jen.3<- cfa(lav.mod.1,sample.cov=cor03a$rho,sample.nobs=500,orthogonal=TRUE,std.lv=TRUE) # Total sample
lav.jen.4<- cfa(lav.mod.1,sample.cov=cor04a$rho,sample.nobs=500,orthogonal=TRUE,std.lv=TRUE) # Total sample
o1 <- omegaFromSem(lav.jen.1,cor04a$rho, plot = F)
o2<-omegaFromSem(lav.jen.2,cor04a$rho, plot = F)
o3<-omegaFromSem(lav.jen.3,cor04a$rho, plot = F)
o4<-omegaFromSem(lav.jen.4,cor04a$rho, plot = F)
Group_1 <- c(o1$omega.group$total)
Group_2 <- c(o2$omega.group$total)
Group_3 <- c(o3$omega.group$total)
Total_sample <- c(o4$omega.group$total)
Omega<- rbind(Group_1,Group_2,Group_3,Total_sample)
cnames <- c("Perception Meritocratic","Perception Non Meritocratic", "Preference Meritocratic","Preference Non Meritocratic")
knitr::kable(Omega, format = "markdown",digits = 2, col.names = cnames)
setwd("~/GitHub/merit-scale")
polyw01<- poly(sjlabelled::remove_all_labels(dat01),
digits = 2,
triangle = "l",
fade.ns = F,
remove.spaces = T,
string.diag = c("$-$","$-$","$-$","$-$","$-$","$-$","$-$","$-$"))
View(polyw01)
load01<- data.frame(round(cbind(inspect(fit1_c,what="std")$lambda,inspect(fit1_o,what="std")$lambda),digits = 2))
load01[load01==c(0.00)] <- NA; names(load01) <- c(1:4,1:4)
View(table01)
install.packages("sessioninfo")
library(sessioninfo)
sessioninfo::session_info()
